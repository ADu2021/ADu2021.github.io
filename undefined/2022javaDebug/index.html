<!DOCTYPE html>
<html lang="en">

<!-- Head tag (contains Google-Analytics、Baidu-Tongji)-->
<head>
  <!-- Google Analytics -->
  
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-xxxxxx-xx"></script>
    <script type="text/javascript">
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());

      gtag('config', 'UA-xxxxxx-xx');
    </script>
  

  <!-- Baidu Tongji -->
  
    <script type="text/javascript">
      // Originial
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?bb5ac2cda14d75e964628a6860376b85";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  <!-- Baidu Push -->
  
    <script>
      (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
      })();
    </script>
  

  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

  <meta name="google-site-verification" content="lxDfCplOZbIzjhG34NuQBgu2gdyRlAtMB4utP5AgEBc"/>
  <meta name="baidu-site-verification" content="PpzM9WxOJU"/>

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content=""/>
  <meta name="keyword" content="adu2021,duyy,livemylife"/>
  <link rel="shortcut icon" href="/img/avatar/code-face.jpg"/>

  <!-- Place this tag in your head or just before your close body tag. -->
  <script async="async" defer="defer" src="https://buttons.github.io/buttons.js"></script>

  
    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/beantech.min.css"/>

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css"/>
    <link rel="stylesheet" href="/css/widget.css"/>
    <link rel="stylesheet" href="/css/rocket.css"/>
    <link rel="stylesheet" href="/css/signature.css"/>
    <link rel="stylesheet" href="/css/catalog.css"/>
    <link rel="stylesheet" href="/css/livemylife.css"/>

    
      <!-- wave start -->
      <link rel="stylesheet" href="/css/wave.css"/>
      <!-- wave end -->
    

    
      <!-- top start (article top hot config) -->
      <link rel="stylesheet" href="/css/top.css"/>
      <!-- top end -->
    

    
      <!-- ThemeColor start -->
      <link rel="stylesheet" href="/css/scroll.css"/>
      <!-- ThemeColor end -->
    

    
      <!-- viewer start (Picture preview) -->
      <link rel="stylesheet" href="/css/viewer.min.css"/>
      <!-- viewer end -->
    

    
      <!-- Search start -->
      <link rel="stylesheet" href="/css/search.css"/>
      <!-- Search end -->
    

    
      <!-- ThemeColor start -->
      <link rel="stylesheet" href="/css/themecolor.css"/>
      <!-- ThemeColor end -->
    

    

    
      <!-- gitalk start -->
      <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"> -->
      <link rel="stylesheet" href="/css/gitalk.css"/>
      <!-- gitalk end -->
    
  

  <!-- Custom Fonts -->
  <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
  <!-- Hux change font-awesome CDN to qiniu -->
  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" type="text/css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Hux Delete, sad but pending in China <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'> <link
  href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/ css'> -->

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script> <![endif]-->

  <!-- ga & ba script hoook -->
  <link rel="canonical" href="https://adu2021.github.io/undefined/2022javaDebug/">
  <title>
    
      Java小学期实验报告 - ADu&#39;s Blog
    
  </title>
<meta name="generator" content="Hexo 5.4.0"></head>


<!-- hack iOS CSS :active style -->

	<body ontouchstart="" class="body--light body--dark">


		<!-- ThemeColor -->
		
		<!-- ThemeColor -->
<style type="text/css">
  .body--light {
    --light-mode: none;
    --dark-mode: block;
  }
  .body--dark {
    --light-mode: block;
    --dark-mode: none;
  }
  i.mdui-icon.material-icons.light-mode {
    display: var(--light-mode);
  }
  i.mdui-icon.material-icons.dark-mode {
    display: var(--dark-mode);
  }
</style>
<div class="toggle" onclick="document.body.classList.toggle('body--dark')">
  <i class="mdui-icon material-icons light-mode"></i>
  <i class="mdui-icon material-icons dark-mode"></i>
</div>
<script>
  //getCookieValue
  function getCookieValue(a) {
    var b = document.cookie.match('(^|[^;]+)\\s*' + a + '\\s*=\\s*([^;]+)');
    return b
      ? b.pop()
      : '';
  }
  let themeMode = 'dark';
  if (getCookieValue('sb-color-mode') && (getCookieValue('sb-color-mode') !== themeMode)) {
    let dbody = document.body.classList;
    themeMode === 'dark' ? dbody.remove('body--dark') : dbody.add('body--dark');
  }

  //setCookieValue
  var toggleBtn = document.querySelector(".toggle");
  toggleBtn.addEventListener("click", function () {
    var e = document.body.classList.contains("body--dark");
    var cookieString = e
      ? "dark"
      : "light";
    var exp = new Date();
    exp.setTime(exp.getTime() + 3 * 24 * 60 * 60 * 1000); //3天过期
    document.cookie = "sb-color-mode=" + cookieString + ";expires=" + exp.toGMTString() + ";path=/";
  });
</script>

		

		<!-- Gitter -->
		
		<!-- Gitter -->
<!-- Docs:https://gitter.im/?utm_source=left-menu-logo -->
<script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'your-community/your-room'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

		

		<!-- Navigation (contains search)-->
		<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">ADu&#39;s Blog</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <!-- Known Issue, found by Hux: <nav>'s height woule be hold on by its content. so, when navbar scale out, the <nav> will cover tags. also mask any touch event of tags, unfortunately. -->
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="/">HOME</a>
          </li>

          
          
          
          
          <li>
            <a href="/about/">
              
              ABOUT
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/archive/">
              
              ARCHIVES
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/categories/">
              
              CATEGORIES
              
              
            </a>
          </li>
          
          
          
          <li>
            <a href="/tags/">
              
              TAGS
              
              
            </a>
          </li>
          
          

          
          <li>
            <a class="popup-trigger">
              <span class="search-icon"></span>SEARCH</a>
          </li>
          

          <!-- LangSelect -->
          
        </ul>
      </div>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>
<!-- progress -->
<div id="progress">
  <div class="line" style="width: 0%;"></div>
</div>

<script>
  // Drop Bootstarp low-performance Navbar Use customize navbar with high-quality material design animation in high-perf jank-free CSS3 implementation
  var $body = document.body;
  var $toggle = document.querySelector('.navbar-toggle');
  var $navbar = document.querySelector('#huxblog_navbar');
  var $collapse = document.querySelector('.navbar-collapse');

  $toggle.addEventListener('click', handleMagic)

  function handleMagic(e) {
    if ($navbar.className.indexOf('in') > 0) {
      // CLOSE
      $navbar.className = " ";
      // wait until animation end.
      setTimeout(function() {
        // prevent frequently toggle
        if ($navbar.className.indexOf('in') < 0) {
          $collapse.style.height = "0px"
        }
      }, 400)
    } else {
      // OPEN
      $collapse.style.height = "auto"
      $navbar.className += " in";
    }
  }
</script>


		<!-- Post Header (contains intro-header、signature、wordcount、busuanzi、waveoverlay) -->
		<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->

  <style type="text/css">
    .body--light {
      /* intro-header */
      --intro-header-background-image-url-home: url('/img/header_img/newhome_bg.jpg');
      --intro-header-background-image-url-post: url('https://i.imgur.com/vCPM7nJ.jpg');
      --intro-header-background-image-url-page: url('/https://i.imgur.com/vCPM7nJ.jpg');
    }
    .body--dark {
      --intro-header-background-image-url-home: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('/img/header_img/newhome_bg.jpg');
      --intro-header-background-image-url-post: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('https://i.imgur.com/vCPM7nJ.jpg');
      --intro-header-background-image-url-page: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2)), url('/https://i.imgur.com/vCPM7nJ.jpg');
    }

    header.intro-header {
       /*post*/
        background-image: var(--intro-header-background-image-url-post);
        /* background-image: url('https://i.imgur.com/vCPM7nJ.jpg'); */
      
    }

    
  </style>





<header class="intro-header">
  <!-- Signature -->
  <div id="signature">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
          
          <div class="post-heading">
            <div class="tags">
              
              <a class="tag" href="/tags/#Java" title="Java">Java</a>
              
              <a class="tag" href="/tags/#Android" title="Android">Android</a>
              
            </div>
            <h1>Java小学期实验报告</h1>
            <h2 class="subheading"></h2>
            <span class="meta">
              Posted by Du Yiyang on
              2022-09-06
            </span>


            
            <!-- WordCount start -->
            <div class="blank_box"></div>
            <span class="meta">
              Estimated Reading Time <span class="post-count">18</span> Minutes
            </span>
            <div class="blank_box"></div>
            <span class="meta">
              Words <span class="post-count">5k</span> In Total
            </span>
            <div class="blank_box"></div>
            <!-- WordCount end -->
            
            
            <!-- 不蒜子统计 start -->
            <span class="meta" id="busuanzi_container_page_pv">
              Viewed <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> Times
            </span>
            <!-- 不蒜子统计 end -->
            


          </div>
          
        </div>
      </div>
    </div>
  </div>

  
  <!-- waveoverlay start -->
  <div class="preview-overlay">
    <svg class="preview-waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
      <defs>
        <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path>
      </defs>
      <g class="preview-parallax">
        <use xlink:href="#gentle-wave" x="48" y="0" fill=var(--gentle-wave1)></use>
        <use xlink:href="#gentle-wave" x="48" y="3" fill=var(--gentle-wave2)></use>
        <use xlink:href="#gentle-wave" x="48" y="5" fill=var(--gentle-wave3)></use>
        <use xlink:href="#gentle-wave" x="48" y="7" fill=var(--gentle-wave)></use>
      </g>
    </svg>
  </div>
  <!-- waveoverlay end -->
  

</header>



		<!-- Main Content (Post contains
	Pager、
	tip、
	socialshare、
	gitalk、gitment、disqus-comment、
	Catalog、
	Sidebar、
	Featured-Tags、
	Friends Blog、
	anchorjs、
	) -->
		<!-- Modify by Yu-Hsuan Yen -->
<!-- Post Content -->
<article>
  <div class="container">
    <div class="row">
      <!-- Post Container -->
      <div class="col-lg-8 col-lg-offset-1 col-md-10 col-md-offset-1 post-container">

        <h1>2022年夏季Java小学期大作业-实验报告</h1>
<p><a href="mailto:duyy21@mails.thu.edu.cn">duyy21@mails.thu.edu.cn</a></p>
<h2 id="代码结构">代码结构</h2>
<h3 id="总览">总览</h3>
<p>本项目通过Android Studio开发，使用了其&quot;Navigation Drawer Activity&quot;模板生成了左侧导航栏，其余部分均为自主开发。Java代码在名为com.java.duyiyang的包下，主要分类有：</p>
<ul>
<li>
<p>用户界面（UI）</p>
<ul>
<li>
<p><code>MainActivity</code></p>
</li>
<li>
<p><code>FragmentWithArticles</code>及其子类<code>HomeFragment</code>,<code>GalleryFragment</code>,<code>ListFragment</code>,<code>FavoriteFragment</code>,<code>RssFragment</code></p>
</li>
<li>
<p><code>SlideshowFragment</code></p>
</li>
<li>
<p><code>CustomAdapter</code>,<code>TabAdapter</code></p>
</li>
<li>
<p><code>ArticleFragment</code></p>
</li>
</ul>
</li>
<li>
<p>网络与API接口</p>
<ul>
<li><code>ApiAdapter</code></li>
</ul>
</li>
<li>
<p>数据库与本地存储</p>
<ul>
<li>
<p><code>Article</code>,<code>ArticleDao</code>,<code>ArticleDatabase</code>,<code>Converters</code></p>
</li>
<li>
<p><code>FileController</code></p>
</li>
</ul>
</li>
<li>
<p>设置</p>
<ul>
<li><code>SettingsFragment</code></li>
</ul>
</li>
</ul>
<p>这一部分介绍各个类的<em>设计思路</em>、<em>功能</em>及<em>代码结构</em>。</p>
<h3 id="用户界面（UI）">用户界面（UI）</h3>
<h4 id="窗口类：在单一Activity下的多个Fragment实现">窗口类：在单一Activity下的多个Fragment实现</h4>
<p>App采用Android Jetpack’s Navigation来管理各窗口。在实现多窗口切换时，采用多个Fragment是比多个Activity更优的做法，因此我们只创建<code>MainActivity</code>这一个Activity类，在其中实现多个不同的窗口Fragment。</p>
<p>由于新闻App有许多界面需要展示文章列表及相应功能，于是我将这部分功能抽象成一个<code>FragmentWithArticles</code>抽象类，大大提高了代码的复用率。主页、搜索结果、历史记录、收藏、Rss源这五个界面分别通过<code>HomeFragment</code>,<code>GalleryFragment</code>,<code>ListFragment</code>,<code>FavoriteFragment</code>,<code>RssFragment</code>这五个继承<code>FragmentWithArticles</code>的类来实现。</p>
<p>此外，搜索界面在<code>SlideshowFragment</code>类中实现。</p>
<h4 id="适配器类：使用RecyclerView的核心">适配器类：使用RecyclerView的核心</h4>
<p>在展示文章列表时，由于列表内元素个数可能很大，如果将他们都加载出来将会十分浪费资源，而RecyclerView可以通过展示容器的复用，以屏幕容纳数量的资源使用（相对小）来加载整个列表内容。使用RecyclerView需要定义其适配器（RecyclerView.Adapter）用于复用加载内容，故<code>FragmentWithArticles</code>及其子类需要与Adapter配合完成显示。</p>
<p>因此，本App中实现了两种适配器类：<code>CustomAdapter</code>和<code>TabAdapter</code>，前者是为了满足显示文章列表的需要，后者是为了满足分类列表“添加和删除操作”这一需求。</p>
<h4 id="文章类">文章类</h4>
<p><code>ArticleFragment</code>用于显示文章的标题、发布者、发布时间、内容（文字图片视频），并且负责处理收藏行为，并将已阅读的新闻（及其图片与收藏状态）存储到本地。</p>
<h3 id="网络与API接口">网络与API接口</h3>
<p><code>ApiAdapter</code>类实现了这部分的全部功能：设置参数并向课程提供的Api请求新闻数据，<em>异步地</em>获取新闻数据，并在完成后通过<code>Method.invode</code>进行回调。同时实现了必要的构造函数等。</p>
<h3 id="数据库与本地存储">数据库与本地存储</h3>
<h4 id="ROOM数据库">ROOM数据库</h4>
<blockquote>
<p>处理大量结构化数据的应用可极大地受益于在本地保留这些数据。最常见的使用场景是缓存相关的数据，这样一来，当设备无法访问网络时，用户仍然可以在离线状态下浏览该内容。——Android Developers</p>
</blockquote>
<p>本App通过ROOM数据库来存储文章（除图片本身）的全部信息。ROOM数据库是Android Jetpack在SQLite上提供的一个抽象层。为了使用它，我们实现了如下类/接口：</p>
<ul>
<li>
<p><code>Article</code>类定义了文章数据的内容：新闻ID、标题、发布时间、关键词、图像地址、视频地址、内容、发布者、分类和收藏状态。同时其构造函数还实现了直接传入<code>JSONObject</code>的支持，即<code>Article</code>类本身负责由Json格式到数据库格式的转换。</p>
</li>
<li>
<p><code>ArticleDao</code>为App内其他组件调用数据库定义了接口，提供了插入、弱插入（不覆盖）、删除、全部删除、根据新闻ID获取文章、获取全部文章等方法。</p>
</li>
<li>
<p><code>ArticleDatabase</code>采用单例模式，通过调用其静态<code>getDatabase()</code>函数返回唯一的room数据库实例，用与MainActivity初始化中的数据库构建环节。</p>
</li>
<li>
<p><code>Converters</code>类负责将数据库不能直接存储的ArrayList类型转化成为数据库可直接存储的String类型。</p>
</li>
</ul>
<h4 id="图片本地存储">图片本地存储</h4>
<p>由于在数据库中直接存储图片数据并不是一个好的选择（会导致数据库大而慢），我们将图片存储于本地的Internal Storage中。又因为App需要实现离线加载图片的功能，我们有这样的策略：当需要加载图片时，先尝试加载本地的图片，若失败再尝试于网络获取。于是，我们将这些策略以静态方法的形式封装到了<code>FileController</code>类当中。</p>
<p><code>FileController</code>类主要负责三项异步任务：图片的加载，图片的保存和图片的删除。</p>
<h3 id="设置">设置</h3>
<p>通过App右上角的按钮可以进入设置界面，允许用户设置如下内容：</p>
<ul>
<li>
<p>删除图片、删除历史记录（及图片）</p>
</li>
<li>
<p>设置RSS源</p>
</li>
<li>
<p>（显示）关于</p>
</li>
</ul>
<h2 id="具体实现">具体实现</h2>
<p>这一部分以前文中代码结构为序，介绍具体实现方法及难点、亮点。</p>
<h3 id="用户界面（UI）-2">用户界面（UI）</h3>
<h4 id="MainActivity">MainActivity</h4>
<p>这部分代码主要由模板自动生成，这里只介绍重点：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ArticleDatabase mDataBase;</span><br><span class="line"><span class="keyword">public</span> ArticleDao mArticleDao;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(...)</span> </span>&#123;</span><br><span class="line">    mDataBase = ArticleDatabase.getDatabase(getApplicationContext());</span><br><span class="line">    mArticleDao = mDataBase.articleDao();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Activity创建时，初始化数据库。</p>
<h4 id="FragmentWithArticles">FragmentWithArticles</h4>
<p>这里先介绍其子类的一般布局设计：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">com.scwang.smart.refresh.layout.SmartRefreshLayout</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="tag">&lt;<span class="name">androidx.recyclerview.widget.RecyclerView</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">com.scwang.smart.refresh.layout.SmartRefreshLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>子类一般基于LinearLayout，内含一个<a target="_blank" rel="noopener" href="https://github.com/scwang90/SmartRefreshLayout"><code>SmartRefreshLayout</code></a>用于实现下拉刷新/上拉加载更多，包含了一个显示文章列表的RecyclerView。</p>
<p>这个抽象类的主要成员变量有：</p>
<ul>
<li>
<p>用于和api交互的ApiAdapter</p>
</li>
<li>
<p>用于操作图形组件的RecyclerView、CustomAdapter、RefreshLayout</p>
</li>
<li>
<p>数据库接口ArticleDao，已加载的文章ArrayList<Article></p>
</li>
</ul>
<p>主要实现了如下方法：</p>
<ul>
<li>
<p><code>parseJson(String)</code>将String类型的Json格式通过JSONObject获取，并调用Article的构造函数，将文章信息储存在ArrayList中。并且在处理结束后对Fragment的一些属性做修改，如：重新允许改变标签，重新允许再次刷新/加载更多等。</p>
</li>
<li>
<p><code>parseXML(InputStream)</code>为了从Rss源获取信息，我们需要处理XML格式的文件。这里的逻辑是：先将XML格式读入为RssArticle类，再调用Article类的构造函数直接将其转化为Article，这样在后续的处理过程中就没有差别了。</p>
</li>
</ul>
<p>此外还声明了<code>afterParseJson()</code>等abstract方法，用于适配不同子类在加载完成后的不同功能需求。</p>
<p><strong>亮点</strong>：这里最大的亮点就是抽象出FragmentWithArticles这个基类，将共有的初始化、“RefreshLayout行为”、“RecyclerView行为”等代码做了复用，使得显示文章列表、下拉刷新、上拉加载更多等功能的开发得到了大大简化，并使得项目的代码结构更加清晰。此外，采用RecyclerView的设计方法也节约了资源。</p>
<p><strong>难点</strong>：抽象出FragmentWithArticles并不是一开始就设计好的，这带来了一些代码重构的工作量。</p>
<h4 id="HomeFragment">HomeFragment</h4>
<p>这个类是展示主页的Fragment，也是所有FragmentWithArticles的子类中最复杂的一个——因为它是不仅是唯一一个用到了两种RecyclerView.Adapter的Fragment，还是唯一一个使用tabLayout实现可滑动、可增删的分类标签的Fragment。</p>
<h5 id="可滑动、可增删的分类标签">可滑动、可增删的分类标签</h5>
<p>这里使用了TabLayout组件实现，自身已经可以支持左右滑动，还实现了Tab的动态增删newTab()等函数。此外，由于“在页面刷新过程中狂乱点击不同标签”这种行为会造成一些奇怪现象，需要在加载过程中禁用整个TabLayout，于是实现了enableAllTab()和disableAllTab()两个函数。</p>
<h5 id="同时使用两种RecyclerView-Adapter">同时使用两种RecyclerView.Adapter</h5>
<p>之所以有这样的需求是因为在设计TabLayout的时候，需要多一个Tab用于跟用户交互实现增删标签，然而同一个RecyclerView的Adapter理论上只能实现一种布局的复用，因此HomeFragment在使用加载文章列表的CustomAdapter的同时，还需要使用加载标签增删UI的TabAdapter。由于一个RecyclerView只能绑定一个Adapter，我们引入了自带的ConcatAdapter类。ConcatAdapter类可以在初始化时传入多个Adapter，然后将ConcatAdapter绑定在RecyclerView中。</p>
<p><strong>难点</strong>：要实现不同的Adapter，仅仅使用ConcatAdapter是不够的，还需要处理二者切换时的逻辑。注意到RecyclerView.Adapter的底层逻辑可以概括为“在自身数据改变时重新根据getItemCount()来将对应数据绑定到ViewHolder中”，于是我们在切换Tab时只需让重写的getItemCount()返回对应的数量（显示时正常返回，隐藏时返回0），然后就可以通过<code>notifyDataSetChanged()</code>告知RecyclerView更新数据重新绘制了。</p>
<p><strong>亮点</strong>：下拉加载更多的速度优化：在大作业给出的api接口文档中，要想实现加载更多文章只能通过增加size参数的方法来实现，这就带来了问题——已经被加载的新闻还会被再次加载，造成了O(N^2)的时间复杂度。然而我发现api接口可以设置<em>page参数</em>，这样在实现加载更多文章的行为时，不需要改变size，只需增加page，然后刷新即可，这将时间复杂度降到了<strong>O(n)</strong>。事实上，从体验上也能看出来：在优化前，下拉加载更多是越来越慢的，在size参数大于140之后加载速度会不太能够接受；在优化后，加载速度几乎没有能明显感受到的差异。</p>
<h5 id="上拉加载，下拉刷新">上拉加载，下拉刷新</h5>
<p>用到了第三方包<a target="_blank" rel="noopener" href="https://github.com/scwang90/SmartRefreshLayout"><code>SmartRefreshLayout</code></a> ，只需自定义其<code>onRefresh()</code>和<code>onLoadMore()</code>两个函数即可。在<code>onRefresh()</code>中，我们将api设置到加载page1，禁止tab操作，然后调用ApiAdapter的刷新函数；在<code>onLoadMore()</code>中，我们将api的page参数+1，其余相同。在调用ApiAdapter的刷新函数时，我们传入HomeFragment类的<code>parseJson()</code>函数作为callback，回调时将取回的数据存入Article中，更新RecyclerView并重新允许tab操作等。</p>
<p><strong>难点</strong>：最初，由于刷新的过程是异步进行的，如果在刷新进行中切换到另一个Tab当中，当刷新完成后仍会重新加载，造成一定混乱。这有两种解决方案：一是禁止刷新时选中tab，二是在加载完成之后判断是否还在原tab中来决定是否更新RecyclerView。由于方案二并没有解决用户可能带来的的短时间多次加载，且需要在callback中加一个参数比较麻烦，本App选择方案一。</p>
<p><strong>亮点</strong>：上拉加载和下拉刷新可以有很多（炫酷的）动画。</p>
<h4 id="RssFragment">RssFragment</h4>
<p><strong>亮点</strong>：作为一个新闻App，除了从给定的API中获取新闻，如果能够有更多的渠道——甚至是让用户自定义新闻来源，岂不美哉？而能想到的最方便的获取新闻的渠道就是Rss了，于是本App还有一个功能，便是加载Rss订阅源的XML格式数据，并以相似的形式呈递给用户。同时，在右上角的设置中还可以选择预设的Rss源，或者自己输入Rss源地址。<s>其实这里也可以有一个TabLayout的但是我比较懒。</s></p>
<p>实现起来也很简单，就把parseJson的调用改为parseXML，然后用XmlPullParser处理。不过似乎不同Rss源的格式略有不同，这里就采用最通用的一种格式来处理了。（就是item标签下有title，description这种）</p>
<p><strong>说明</strong>：这部分内容并不是大作业要求内容。由于RSS源内容格式不定且往往采用html语言描述，在显示时采用WebView控件，且不提供历史记录、收藏的功能（这不应当被视为未完成要求）。</p>
<h4 id="SlideshowFragment">SlideshowFragment</h4>
<p>这是搜索界面的Fragment。分别用TextInputEditText、MaterialDatePicker和Spinner实现了关键词、日期范围和类别的搜索设置。最后把参数传给ApiAdapter，进一步传给ListFragment实现搜索。</p>
<p><strong>亮点</strong>：使用了MaterialDatePicker，使得日期范围的选择变得轻松，并且UI也更美观。</p>
<h4 id="ArticleFragment">ArticleFragment</h4>
<p>显示文章的标题、发布者、发布时间、内容（文字图片视频），并且负责处理收藏行为，并将已阅读的新闻（及其图片与收藏状态）存储到本地。</p>
<p><code>FragmentWithArticles</code>类在通过Navigation调用ArticleFragment前，会向其传递一个Bundle，这个bundle里面塞了要显示的Article等内容，相当于函数调用时的实参。</p>
<p>ArticleFragment在一个LinearLayout的容器下，通过TextView和ImageView来显示。通过在LinearLayout外面套一层ScrollView来实现滑动显示。</p>
<p>ArticleFragment的一大重要功能就是将以阅读的新闻存储到本地，因此它也能接触到数据库接口ArticleDao。基本地，在开始时ArticleFragment会将文章<em>尝试</em>存入数据库中，但由于这里的Article是从Api中获取的，并没有收藏信息，如果直接存入数据库会将收藏信息覆盖掉，于是这里的<em>冲突策略</em>选择的是Ignore，即“weak Insert”，并且在加载时询问数据库是否有收藏信息。相对的，另一大功能——收藏，所对应的<em>冲突策略</em>是Replace。此外，为了避免用户狂点收藏按钮导致的数据库高频读写，我将Insert操作的时机放在了Fragment生命周期中的onPause()中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ArticleDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Insert</span> (onConflict = OnConflictStrategy.REPLACE)</span><br><span class="line">    <span class="function">Completable <span class="title">insert</span><span class="params">(Article article)</span></span>; <span class="comment">// 用于收藏</span></span><br><span class="line">    <span class="meta">@Insert</span> (onConflict = OnConflictStrategy.IGNORE)</span><br><span class="line">    <span class="function">Completable <span class="title">weakInsert</span><span class="params">(Article article)</span></span>; <span class="comment">// 用于初始化保存</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="网络与API接口-2">网络与API接口</h3>
<p><code>ApiAdapter</code>具有以下几个属性：size, startDate, endDate, words, categories, page，分别对应着api接口中的不同参数，并且有相应的修改属性的方法。它还拥有一个私有方法<code>getUrl()</code>，能够将这些参数转化为对应的URL，在调用其<code>getContent()</code>方法时将会向<code>getUrl()</code>的地址发出GET请求，将返回的内容以String的形式存储，完成后调用传入的callback，告知请求方异步的网络读取操作已经完成。</p>
<p><strong>亮点</strong>：将与API相关的操作和网络请求封装了起来，具有良好的复用性。</p>
<h3 id="数据库与本地存储-2">数据库与本地存储</h3>
<h4 id="Article类">Article类</h4>
<p>Article类的一个重要实现是以JSONObject为参数的构造函数，这相当于是将JSONObject处理成了Article。一般的参数，如title，pubDate等，通过<code>getString()</code>函数就可得到，（<strong>难点：</strong>）但是图片不然，因为image参数可能很奇怪（比如&quot;[, , , ]&quot;这种），因此我们需要在用逗号做分割之后再用正则表达式进行一些“纯化”，主要代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String[] res = imageRaw.substring(<span class="number">1</span>, imageRaw.length() - <span class="number">1</span>).split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>, len = res.length; i &lt; len; i++) &#123;</span><br><span class="line">    Pattern pattern = Pattern.compile(<span class="string">&quot;\\s*(\\S+)\\s*&quot;</span>);</span><br><span class="line">    Matcher matcher = pattern.matcher(res[i]);</span><br><span class="line">    <span class="keyword">if</span>(matcher.find())</span><br><span class="line">        image.add(matcher.group(<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此外，为了方便向ArticleFragment传递参数，还实现了从bundle的构造函数和与之配套的bundle打包函数<code>packBundle()</code>。（这一方法在ApiAdapter类也有用到）</p>
<h4 id="ArticleDao接口">ArticleDao接口</h4>
<p><code>ArticleDao</code>类的“实现”本质上就是写了几条SQLite语句，这里列举三个：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Query</span> (&quot;SELECT * FROM article_table WHERE idx =:idx&quot;)</span><br><span class="line">Single<span class="operator">&lt;</span>Article<span class="operator">&gt;</span> selectById(String idx); <span class="operator">/</span><span class="operator">/</span> 根据NewsID查找Article</span><br><span class="line"></span><br><span class="line"><span class="variable">@Query</span> (&quot;SELECT * FROM article_table WHERE marked = 1 ORDER BY rowid DESC&quot;)</span><br><span class="line">Single<span class="operator">&lt;</span>Article[]<span class="operator">&gt;</span> selectAllFavorite(); <span class="operator">/</span><span class="operator">/</span> 倒序获取所有收藏</span><br><span class="line"></span><br><span class="line"><span class="variable">@Query</span> (&quot;DELETE FROM article_table&quot;) </span><br><span class="line">Completable clear(); <span class="operator">/</span><span class="operator">/</span> 清除本地数据库</span><br></pre></td></tr></table></figure>
<p>这里的降序写法是为了满足历史记录和收藏“后看的放在前面”的需求（SQL和SQLite的降序写法好像还不一样，ROOM用的是SQLite。。。）</p>
<h4 id="ArticleDatabase-Converters">ArticleDatabase &amp; Converters</h4>
<p>ArticleDatabase基本上就纯按照Android Developers上面的例子写的，主要实现就是一个静态方法<code>getDatabase()</code>用于获取单例模式下的数据库。</p>
<p>Converters实现了ArrayList<String>和String的相互转换（room数据库要求实现这个converter）。具体方法为调用Gson库，将ArrayList<String>转化为Json格式的字符串。</p>
<h4 id="FileController">FileController</h4>
<p>FileController的<code>saveFile()</code>和<code>loadFile()</code>函数都使用了Picasso库来实现，二者的区别在于Picasso的<code>.into()</code>里面的参数，save是一个重载了onBitmapLoaded()的Target，load是一个ImageView。此外，为了实现“看过的图片离线也能加载”的需求，在<code>loadFile()</code>成功后，会调用<code>saveFile()</code>保存到本地。另外之前已经提到过，<code>loadFile()</code>传入url和本地文件名，优先加载本地图片，失败后再加载网络资源。</p>
<p><strong>难点与亮点</strong>：这部分有很多的异步操作：Picasso的.into(Target)，文件IO，网络…，容易写出Callback Hell，好在回调的层数不是那么多。事实上，这里的<code>Target</code>和上面ArticleDao中返回的<code>Completable</code>，<code>Single&lt;T&gt;</code>，都是支持<em>委托</em>的，他们本身就是为了线型编程，避免写出金字塔形的Callback Hell而存在的。</p>
<h3 id="设置-2">设置</h3>
<p>从UI右上角的三个点里面可以进到设置界面，主要由三个部分组成：清除本地存储、设置RSS源、About（就是个简介）。</p>
<p><strong>亮点</strong>：以下应该都算得上是亮点。</p>
<h4 id="清除本地存储">清除本地存储</h4>
<p>清除本地图片的实现就是获取所有的Article，然后对着文件地址都删一遍就行了（有try-catch无脑删就行了）。清除所有缓存就是在清除所有本地图片之后调用ArticleDao接口中的清空数据库。（又是一个Async Task）</p>
<h4 id="设置Rss源">设置Rss源</h4>
<p>有两种设置方式：一种通过下拉菜单选择预设的15+个RSS源，另一种就是通过用户输入RSS源地址自定义。其实本来还想对后者加一个检查是否为合法RSS源的判断函数，但是发现自己判断的条件总是不能涵盖所有情形，遂放弃了这个Feature。</p>
<h3 id="其他难点与亮点">其他难点与亮点</h3>
<ul>
<li>
<p>亮点：采用Material3主题，并且换了个中文字体，使得UI界面更漂亮。</p>
</li>
<li>
<p>难点：做完了感觉花费最多精力的地方就是HomeFragment里面那个两种RecyclerAdapter来回切导致的一大堆问题，感觉这并不是一个好的实现方法。</p>
</li>
</ul>
<h2 id="总结与心得">总结与心得</h2>
<p>从8月26号下载Android Studio开始，到8月29日大作业发布，再到9月5日大作业基本完成，能够明显地感觉到对Android Java开发的逻辑逐渐熟悉，对项目的掌控程度也越来越高。对我而言，提升最大的时候是刚开始熟悉安卓开发时有些陡峭的学习曲线——最初真的是连模板里面的几个类都看不懂，但是通过“面向Google”，“面向Android Developers”和“面向StackOverflow”的开发方式，我在改Bug的同时逐渐了解了这个app构建的方式。这要感谢老师的课程设置，使得我不用因为考试压力在前期拘泥于Java语言的细支末节（当然，它们同样重要），可以专心打磨大作业和（浅薄的）学习能力、工程能力。</p>
<p>回首上大学以来的Coding大作业：从Decimal开立方，到Win32编程、Qt编程，这次的Java Android开发给我留下印象最深的是诸多的异步操作。文件IO、HTTP GET、数据库读写、Picasso Load，这可以算是我首次接触各种各样的的异步编程（QT那个网络部分就不用太异步），虽然说代码写得没有理想中那么漂亮，底层原理也有待学习，但至少接触了许多新的理念还是挺有趣的。</p>
<p>顺便吐槽一下这东西真得自学，而且就是网上的资源方便一些：之前还在图书馆借了本《Java与Android移动应用开发》，唯一的作用就是知道了怎么parse Json和XML，而且也没有涉及jetpack内容，好在是Android Developers的文档已经足够详尽了，未尽之处也可以Google。以及课程设置也许可以提前一些？比如第三周把课上完这种。</p>
<p>还有一些Debug的总结在<a href="https://adu2021.github.io/undefined/Java-Android/">这里</a>。最后感谢教学团队，特别是许斌老师刘明辉助教对课程的所有付出！</p>


        <hr>
        <!-- Pager -->
        <ul class="pager">
          
          
          <li class="next">
            <a href="/undefined/Java-Android/" data-toggle="tooltip" data-placement="top" title="Java&Android Debug Log">Next Post &rarr;</a>
          </li>
          
        </ul>

        
        <!-- tip start -->
        <!-- tip -->
<!-- tip start -->
<div class="tip">
  <p>
    
      If you like this blog or find it useful for you, you are welcome to comment on it. You are also welcome to share this blog, so that more people can participate in it. If the images used in the blog infringe your copyright, please contact the author to delete them. Thank you !
    
  </p>
</div>
<!-- tip end -->

        <!-- tip end -->
        

        
        <!-- Sharing Srtart -->
        <!-- Social Social Share Post -->
<!-- Docs:https://github.com/overtrue/share.js -->

<div class="social-share" data-initialized="true" data-disabled="tencent ,douban ,qzone ,linkedin ,facebook ,google ,diandian" data-wechat-qrcode-helper="" align="center">
  <ul class="list-inline text-center social-share-ul">
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-twitter">
        <i class="fa fa-twitter fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a class="social-share-icon icon-wechat">
        <i class="fa fa-weixin fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-weibo">
        <i class="fa fa-weibo fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon icon-qq">
        <i class="fa fa-qq fa-1x" aria-hidden="true"></i>
      </a>
    </li>
    <li class="social-share-li">
      <a target="_blank" class="social-share-icon" href="mailto:?subject=Java小学期实验报告&body=Hi,I found this website and thought you might like it https://adu2021.github.io/undefined/2022javaDebug/">
        <i class="fa fa-envelope fa-1x" aria-hidden="true"></i>
      </a>
    </li>
  </ul>
</div>

<!-- css & js -->
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css"> -->
<script defer="defer" async="true" src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>

        <!-- Sharing End -->
        
        <hr>

        <!-- comments start -->
        <!-- 1. gitalk comment -->

  <!-- gitalk start -->
  <!-- Docs:https://github.com/gitalk/gitalk/blob/master/readme-cn.md -->

  <div id="gitalk-container"></div>

  
    <!-- <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.js"></script> -->
    <script src="/js/comment/gitalk.js"></script>
  

  <script>
    var gitalk = new Gitalk({
      clientID: 'ff75338a1add7ef1c2c6',
      clientSecret: '0d3daff08fa21827ac90b2682d812688a20635ee',
      repo: 'adu2021.github.io',
      owner: 'ADu2021',
      admin: 'ADu2021',
      id: 'Tue Sep 06 2022 10:48:38 GMT+0000', // Ensure uniqueness and length less than 50
      distractionFreeMode: false, // Facebook-like distraction free mode
      perPage: 10,
      pagerDirection: 'last',
      createIssueManually: false,
      language: 'zh-CN',
      proxy: 'https://shielded-brushlands-08810.herokuapp.com/https://github.com/login/oauth/access_token'
    });
    gitalk.render('gitalk-container');

    var gtFolded = () => {
      setTimeout(function () {
        let markdownBody = document.getElementsByClassName("markdown-body");
        let list = Array.from(markdownBody);
        list.forEach(item => {
          if (item.clientHeight > 250) {
            item.classList.add('gt-comment-body-folded');
            item.style.maxHeight = '250px';
            item.title = 'Click to Expand';
            item.onclick = function () {
              item.classList.remove('gt-comment-body-folded');
              item.style.maxHeight = '';
              item.title = '';
              item.onclick = null;
            };
          }
        })
      }, 800);
    }
  </script>

  <!-- gitalk end -->


<!-- 2. gitment comment -->


<!-- 3. disqus comment -->


        <!-- comments end -->
        <hr>

      </div>

      <!-- Catalog: Tabe of Content -->
      <!-- Table of Contents -->

    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">2022年夏季Java小学期大作业-实验报告</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">代码结构</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%80%BB%E8%A7%88"><span class="toc-nav-number">1.1.1.</span> <span class="toc-nav-text">总览</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2%EF%BC%88UI%EF%BC%89"><span class="toc-nav-number">1.1.2.</span> <span class="toc-nav-text">用户界面（UI）</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E7%AA%97%E5%8F%A3%E7%B1%BB%EF%BC%9A%E5%9C%A8%E5%8D%95%E4%B8%80Activity%E4%B8%8B%E7%9A%84%E5%A4%9A%E4%B8%AAFragment%E5%AE%9E%E7%8E%B0"><span class="toc-nav-number">1.1.2.1.</span> <span class="toc-nav-text">窗口类：在单一Activity下的多个Fragment实现</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E7%B1%BB%EF%BC%9A%E4%BD%BF%E7%94%A8RecyclerView%E7%9A%84%E6%A0%B8%E5%BF%83"><span class="toc-nav-number">1.1.2.2.</span> <span class="toc-nav-text">适配器类：使用RecyclerView的核心</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E6%96%87%E7%AB%A0%E7%B1%BB"><span class="toc-nav-number">1.1.2.3.</span> <span class="toc-nav-text">文章类</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E7%BD%91%E7%BB%9C%E4%B8%8EAPI%E6%8E%A5%E5%8F%A3"><span class="toc-nav-number">1.1.3.</span> <span class="toc-nav-text">网络与API接口</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8E%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8"><span class="toc-nav-number">1.1.4.</span> <span class="toc-nav-text">数据库与本地存储</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#ROOM%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-nav-number">1.1.4.1.</span> <span class="toc-nav-text">ROOM数据库</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E5%9B%BE%E7%89%87%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8"><span class="toc-nav-number">1.1.4.2.</span> <span class="toc-nav-text">图片本地存储</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E8%AE%BE%E7%BD%AE"><span class="toc-nav-number">1.1.5.</span> <span class="toc-nav-text">设置</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">具体实现</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2%EF%BC%88UI%EF%BC%89-2"><span class="toc-nav-number">1.2.1.</span> <span class="toc-nav-text">用户界面（UI）</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#MainActivity"><span class="toc-nav-number">1.2.1.1.</span> <span class="toc-nav-text">MainActivity</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#FragmentWithArticles"><span class="toc-nav-number">1.2.1.2.</span> <span class="toc-nav-text">FragmentWithArticles</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#HomeFragment"><span class="toc-nav-number">1.2.1.3.</span> <span class="toc-nav-text">HomeFragment</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E5%8F%AF%E6%BB%91%E5%8A%A8%E3%80%81%E5%8F%AF%E5%A2%9E%E5%88%A0%E7%9A%84%E5%88%86%E7%B1%BB%E6%A0%87%E7%AD%BE"><span class="toc-nav-number">1.2.1.3.1.</span> <span class="toc-nav-text">可滑动、可增删的分类标签</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E5%90%8C%E6%97%B6%E4%BD%BF%E7%94%A8%E4%B8%A4%E7%A7%8DRecyclerView-Adapter"><span class="toc-nav-number">1.2.1.3.2.</span> <span class="toc-nav-text">同时使用两种RecyclerView.Adapter</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E4%B8%8A%E6%8B%89%E5%8A%A0%E8%BD%BD%EF%BC%8C%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0"><span class="toc-nav-number">1.2.1.3.3.</span> <span class="toc-nav-text">上拉加载，下拉刷新</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#RssFragment"><span class="toc-nav-number">1.2.1.4.</span> <span class="toc-nav-text">RssFragment</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#SlideshowFragment"><span class="toc-nav-number">1.2.1.5.</span> <span class="toc-nav-text">SlideshowFragment</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#ArticleFragment"><span class="toc-nav-number">1.2.1.6.</span> <span class="toc-nav-text">ArticleFragment</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E7%BD%91%E7%BB%9C%E4%B8%8EAPI%E6%8E%A5%E5%8F%A3-2"><span class="toc-nav-number">1.2.2.</span> <span class="toc-nav-text">网络与API接口</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8E%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8-2"><span class="toc-nav-number">1.2.3.</span> <span class="toc-nav-text">数据库与本地存储</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Article%E7%B1%BB"><span class="toc-nav-number">1.2.3.1.</span> <span class="toc-nav-text">Article类</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#ArticleDao%E6%8E%A5%E5%8F%A3"><span class="toc-nav-number">1.2.3.2.</span> <span class="toc-nav-text">ArticleDao接口</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#ArticleDatabase-Converters"><span class="toc-nav-number">1.2.3.3.</span> <span class="toc-nav-text">ArticleDatabase &amp; Converters</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#FileController"><span class="toc-nav-number">1.2.3.4.</span> <span class="toc-nav-text">FileController</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E8%AE%BE%E7%BD%AE-2"><span class="toc-nav-number">1.2.4.</span> <span class="toc-nav-text">设置</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E6%B8%85%E9%99%A4%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8"><span class="toc-nav-number">1.2.4.1.</span> <span class="toc-nav-text">清除本地存储</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E8%AE%BE%E7%BD%AERss%E6%BA%90"><span class="toc-nav-number">1.2.4.2.</span> <span class="toc-nav-text">设置Rss源</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E5%85%B6%E4%BB%96%E9%9A%BE%E7%82%B9%E4%B8%8E%E4%BA%AE%E7%82%B9"><span class="toc-nav-number">1.2.5.</span> <span class="toc-nav-text">其他难点与亮点</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E5%BF%83%E5%BE%97"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text">总结与心得</span></a></li></ol></li></ol>
        
        </div>
      </aside>
    



      <!-- Sidebar Container -->
      <div class="
                col-lg-8 col-lg-offset-1
                col-md-10 col-md-offset-1
                sidebar-container">

        <!-- Featured Tags -->
        
        <section>
          <!-- no hr -->
          <h5>
            <a href="/tags/">FEATURED TAGS</a>
          </h5>
          <div class="tags">
            
            <a class="tag" href="/tags/#Java" title="Java">Java</a>
            
            <a class="tag" href="/tags/#Android" title="Android">Android</a>
            
          </div>
        </section>
        

        <!-- Friends Blog -->
        
        <hr>
        <h5>FRIENDS</h5>
        <ul class="list-inline">

          
        </ul>
        
      </div>
    </div>
  </div>
</article>



<!-- anchorjs start -->
<!-- async load function -->
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script type="text/javascript">
  // async load function
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function(e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  };
</script>
<script type="text/javascript">
  //anchor-js, Doc:http://bryanbraun.github.io/anchorjs/
  async ("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js", function() {
    anchors.options = {
      visible: 'hover',
      placement: 'left',
      // icon: 'ℬ'
      icon: '❡'
    };
    anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
  });
</script>
<style>
  /* place left on bigger screen */
  @media all and (min-width: 800px) {
    .anchorjs-link {
      position: absolute;
      left: -0.75em;
      font-size: 1.1em;
      margin-top: -0.1em;
    }
  }
</style>

<!-- anchorjs end -->



		<!-- Footer (contains ThemeColor、viewer) -->
		<!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
          

          
            <li>
              <a target="_blank" href="https://github.com/ADu2021">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
          

          

          

          

          

          

          

        </ul>
        <p class="copyright text-muted">
          Copyright &copy;
          Du Yiyang
          2022
          <br>
          Theme by
          <a target="_blank" rel="noopener" href="http://beantech.org">BeanTech</a>
          <span style="display: inline-block; margin: 0 5px;">
            <i class="fa fa-heart"></i>
          </span>
          re-Ported by
          <a target="_blank" rel="noopener" href="https://v-vincen.life/">Live My Life</a>
          |
          <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=V-Vincen&repo=V-Vincen.github.io&type=star&count=true"></iframe>
        </p>
      </div>
    </div>
  </div>
</footer>

<a id="rocket" href="#top" class=""></a>


  <!-- jQuery -->
  <script type="text/javascript" src="/js/jquery.min.js"></script>
  <!-- Bootstrap Core JavaScript -->
  <script type="text/javascript" src="/js/bootstrap.min.js"></script>
  <!-- Custom Theme JavaScript -->
  <script type="text/javascript" src="/js/hux-blog.min.js"></script>
  <!-- catalog -->
  <script async="true" type="text/javascript" src="/js/catalog.js"></script>
  <!-- totop(rocket) -->
  <script async="true" type="text/javascript" src="/js/totop.js"></script>

  
    <!-- Busuanzi JavaScript -->
    <script async="async" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <!-- Scroll start -->
    <script async="async" type="text/javascript" src="/js/scroll.js"></script>
    <!-- Scroll end -->
  

  

  
    <!-- Mouseclick -->
    <script type="text/javascript" src="/js/mouseclick.js" content='The first step is as good as half over...,Laugh and grow fat...,Man proposes God disposes...,When all else is lost the future still remains...,Wasting time is robbing oneself...,Sharp tools make good work...,Cease to struggle and you cease to live...,A friend in need is a friend indeed...,Faith can move mountains...' color='#9933CC,#339933,#66CCCC,#FF99CC,#CCCCFF,#6666CC,#663399,#66CC99,#FF0033'></script>
  

  
    <!-- ribbon -->
    <script type="text/javascript" src="/js/ribbonDynamic.js"></script>
  

  






  <!-- viewer start -->
  <!-- viewer start (Picture preview) -->
  
    <script async="async" type="text/javascript" src="/js/viewer/viewer.min.js"></script>
    <script async="async" type="text/javascript" src="/js/viewer/pic-viewer.js"></script>
  

  <!-- viewer end -->


<script>
  // async load function
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function (e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  }

  // fastClick.js
  async ("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function () {
    var $nav = document.querySelector("nav");
    if ($nav)
      FastClick.attach($nav);
    }
  )
</script>

<!-- Because of the native support for backtick-style fenced code blocks right within the Markdown is landed in Github Pages, From V1.6, There is no need for Highlight.js, so Huxblog drops it officially. -
https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0 - https://help.github.com/articles/creating-and-highlighting-code-blocks/ -->
<!-- <script> async ("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function () { hljs.initHighlightingOnLoad(); }) </script> <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet"> -->

<!-- jquery.tagcloud.js -->
<!-- <script> // only load tagcloud.js in tag.html if ($('#tag_cloud').length !== 0) { async ("https://adu2021.github.io/js/jquery.tagcloud.js", function () { $.fn.tagcloud.defaults = { // size: { start: 1, end: 1, unit: 'em' }, color: {
start: '#bbbbee', end: '#0085a1' } }; $('#tag_cloud a').tagcloud(); }) } </script> -->


		<!-- Search -->
		
		<div class="popup search-popup local-search-popup">
  <span class="popup-btn-close">
    ESC
  </span>
  <div class="container">
    <div class="row">
      <!-- <div class="col-md-9 col-md-offset-1"> -->
      <div class="col-lg-9 col-lg-offset-1 col-md-10 col-md-offset-1 local-search-content">

        <div class="local-search-header clearfix">

          <div class="local-search-input-wrapper">
            <span class="search-icon">
              <i class="fa fa-search fa-lg" style="margin: 25px 10px 25px 20px;"></i>
            </span>
            <input autocomplete="off" placeholder="SEARCH..." type="text" id="local-search-input">
          </div>
        </div>
        <div id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>


  
    <script src="/js/ziploader.js"></script>
  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.json";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    // monitor main search box;
    var onPopupClose = function (e) {
      $('.popup').fadeOut(300);
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $('.popup').fadeIn(300);
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }
    // get search zip version
    $.get('/searchVersion.json?t=' + (+new Date()), function (res) {
      if (localStorage.getItem('searchVersion') !== res) {
        localStorage.setItem('searchVersion', res);
        initSearchJson();
      }
    });

    function initSearchJson() {
      initLoad(['/search.flv'], {
        loadOptions: {
          success: function (obj) {
            localStorage.setItem('searchJson', obj['search.json'])
          },
          error: function (e) {
            return console.log(e)
          }
        },
        returnOptions: {
          'json': TYPE_TEXT
        },
        mimeOptions: {
          'json': 'application/json'
        }
      })
    }
    // search function;
    var searchFunc = function (search_id, content_id) {
      'use strict';
      isfetched = true;
      var datas = JSON.parse(localStorage.getItem('searchJson'));
      // console.log(search_id)
      var input = document.getElementById(search_id);
      var resultContent = document.getElementById(content_id);
      var inputEventFunction = function () {
        var searchText = input.value.trim().toLowerCase();
        var keywords = searchText.split(/[\s\-]+/);
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        var resultItems = [];
        if (searchText.length > 0) {
          // perform local searching
          datas.forEach(function (data) {
            var isMatch = false;
            var hitCount = 0;
            var searchTextCount = 0;
            var title = data.title
              ? data.title.trim()
              : '';
            var titleInLowerCase = title.toLowerCase();
            var content = data.content
              ? data.content.trim().replace(/<[^>]+>/g, "")
              : '';
            var contentInLowerCase = content.toLowerCase();
            var articleUrl = decodeURIComponent(data.url);

            var date = data.date;
            var dateTime = date.replace(/T/, " ").replace(/.000Z/, "");
            var imgUrl = data.header_img;
            


            var indexOfTitle = [];
            var indexOfContent = [];
            // only match articles with not empty titles
            keywords.forEach(function (keyword) {
              function getIndexByWord(word, text, caseSensitive) {
                var wordLen = word.length;
                if (wordLen === 0) {
                  return [];
                }
                var startPosition = 0,
                  position = [],
                  index = [];
                if (!caseSensitive) {
                  text = text.toLowerCase();
                  word = word.toLowerCase();
                }
                while ((position = text.indexOf(word, startPosition)) > -1) {
                  index.push({position: position, word: word});
                  startPosition = position + wordLen;
                }
                return index;
              }
              indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
              indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
            });
            if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
              isMatch = true;
              hitCount = indexOfTitle.length + indexOfContent.length;
            }
            // show search results
            if (isMatch) {
              // sort index by position of keyword
              [indexOfTitle, indexOfContent].forEach(function (index) {
                index.sort(function (itemLeft, itemRight) {
                  if (itemRight.position !== itemLeft.position) {
                    return itemRight.position - itemLeft.position;
                  } else {
                    return itemLeft.word.length - itemRight.word.length;
                  }
                });
              });
              // merge hits into slices
              function mergeIntoSlice(text, start, end, index) {
                var item = index[index.length - 1];
                var position = item.position;
                var word = item.word;
                var hits = [];
                var searchTextCountInSlice = 0;
                while (position + word.length <= end && index.length != 0) {
                  if (word === searchText) {
                    searchTextCountInSlice++;
                  }
                  hits.push({position: position, length: word.length});
                  var wordEnd = position + word.length;
                  // move to next position of hit
                  index.pop();
                  while (index.length != 0) {
                    item = index[index.length - 1];
                    position = item.position;
                    word = item.word;
                    if (wordEnd > position) {
                      index.pop();
                    } else {
                      break;
                    }
                  }
                }
                searchTextCount += searchTextCountInSlice;
                return {hits: hits, start: start, end: end, searchTextCount: searchTextCountInSlice};
              }
              var slicesOfTitle = [];
              if (indexOfTitle.length != 0) {
                slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
              }
              var slicesOfContent = [];
              while (indexOfContent.length != 0) {
                var item = indexOfContent[indexOfContent.length - 1];
                var position = item.position;
                var word = item.word;
                // cut out 100 characters
                var start = position - 20;
                var end = position + 80;
                if (start < 0) {
                  start = 0;
                }
                if (end < position + word.length) {
                  end = position + word.length;
                }
                if (end > content.length) {
                  end = content.length;
                }
                slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
              }
              // sort slices in content by search text's count and hits' count
              slicesOfContent.sort(function (sliceLeft, sliceRight) {
                if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                  return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                  return sliceRight.hits.length - sliceLeft.hits.length;
                } else {
                  return sliceLeft.start - sliceRight.start;
                }
              });
              // select top N slices in content
              var upperBound = parseInt('1');
              if (upperBound >= 0) {
                slicesOfContent = slicesOfContent.slice(0, upperBound);
              }
              // highlight title and content
              function highlightKeyword(text, slice) {
                var result = '';
                var prevEnd = slice.start;
                slice.hits.forEach(function (hit) {
                  result += text.substring(prevEnd, hit.position);
                  var end = hit.position + hit.length;
                  result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                  prevEnd = end;
                });
                result += text.substring(prevEnd, slice.end);
                return result;
              }
              var resultItem = '';

              // if (slicesOfTitle.length != 0) {   resultItem += "<li><a target='_blank' href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>"; } else {   resultItem += "<li><a target='_blank' href='" +
              // articleUrl + "' class='search-result-title'>" + title + "</a>"; } slicesOfContent.forEach(function (slice) {   resultItem += "<a target='_blank' href='" + articleUrl + "'><p class=\"search-result\">" + highlightKeyword(content, slice) +
              // "...</p></a>"; }); resultItem += "</li>";

              if (slicesOfTitle.length != 0) {
                resultItem += "<a target='_blank' href='" + articleUrl + "' class='search-result'><div class='search-result-left'><div class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</div><time class='search-result-date'>" + dateTime + "</time>";
              } else {
                resultItem += "<a target='_blank' href='" + articleUrl + "' class='search-result'><div class='search-result-left'><div class='search-result-title'>" + title + "</div><time class='search-result-date'>" + dateTime + "</time>";
              }
              slicesOfContent.forEach(function (slice) {
                resultItem += "<p class=\"search-result-content\">" + highlightKeyword(content, slice) + "...</p>";
              });
              resultItem += "</div><div class='search-result-right'><img class='media-image' src='" + imgUrl + "' width='64px' height='48px'></img></div></a>";

              resultItems.push({item: resultItem, searchTextCount: searchTextCount, hitCount: hitCount, id: resultItems.length});
            }
          })
        };

        if (keywords.length === 1 && keywords[0] === "") {
          resultContent.innerHTML = '<div id="no-result"></div>'
        } else if (resultItems.length === 0) {
          resultContent.innerHTML = '<div id="no-result"></div>'
        } else {
          resultItems.sort(function (resultLeft, resultRight) {
            if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
              return resultRight.searchTextCount - resultLeft.searchTextCount;
            } else if (resultLeft.hitCount !== resultRight.hitCount) {
              return resultRight.hitCount - resultLeft.hitCount;
            } else {
              return resultRight.id - resultLeft.id;
            }
          });
          var searchResultList = '<div class=\"search-result-list\">';
          resultItems.forEach(function (result) {
            searchResultList += result.item;
          })
          searchResultList += "</div>";
          resultContent.innerHTML = searchResultList;
        }
      }
      if ('auto' === 'auto') {
        input.addEventListener('input', inputEventFunction);
      } else {
        $('.search-icon').click(inputEventFunction);
        input.addEventListener('keypress', function (event) {
          if (event.keyCode === 13) {
            inputEventFunction();
          }
        });
      }
      // remove loading animation
      $('body').css('overflow', '');
      proceedsearch();
    }
    // handle and trigger popup window;
    $('.popup-trigger').click(function (e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc('local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });
    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function (e) {
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 && $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });

    document.addEventListener('mouseup', (e) => {
      var _con = document.querySelector(".local-search-content");
      if (_con) {
        if (!_con.contains(e.target)) {
          onPopupClose();
        }
      }
    });
  </script>


		
	<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
